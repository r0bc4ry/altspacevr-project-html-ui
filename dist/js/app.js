"use strict";angular.module("myApp",["ngRoute","ngDialog","ngDropdowns","myApp.controllers","myApp.directives","myApp.services","myApp.templates"]),angular.module("myApp.controllers",[]),angular.module("myApp.directives",[]),angular.module("myApp.services",[]),angular.module("myApp.templates",[]),angular.module("myApp").config(["$routeProvider",function(e){e.when("/",{templateUrl:"dashboard/dashboard.html",controller:"DashboardController"}),e.when("/spaces/:id",{templateUrl:"space/space.html",controller:"SpaceController"}),e.otherwise({redirectTo:"/"})}]),angular.module("myApp.controllers").controller("DashboardController",["$location","$log","$q","$rootScope","$scope","Space","User",function(e,t,a,n,r,o,c){function i(){var e=a.defer();return o.getAll(function(n){var r=[];n.forEach(function(e){var n=a.defer();r.push(n),c.getById({id:e.created_by},function(t){e.created_by=t,n.resolve()},function(e){t.error(e)})}),a.all(r).then(function(){e.resolve(n)})},function(e){t.error(e)}),e.promise}r.ddSelectOptions=[{text:"All Spaces",value:"all"},{text:"Welcome Spaces",value:"welcome"},{text:"Private Spaces",value:"private"},{text:"Featured Spaces",value:"featured"}],r.ddSelectSelected={text:"All Spaces",value:"all"},r.onDropdownChange=function(e){i().then(function(t){r.spaces=t.filter(function(t){return"all"===e.value?t:t[e.value]})})},function(){i().then(function(e){r.spaces=e})}()}]),angular.module("myApp.controllers").controller("SpaceController",["$location","$log","$routeParams","$rootScope","$scope","ngDialog","Space","User",function(e,t,a,n,r,o,c,i){function l(){return r.editableSpace.title&&r.editableSpace.description?!0:!1}r.section="analytics",r.onEditCancel=function(){r.editableSpace=angular.copy(r.space),r.section="analytics"},r.onEditSave=function(){return l()?void c.updateById({id:r.editableSpace.id},r.editableSpace,function(e){r.space=angular.copy(r.editableSpace),r.section="analytics"},function(e){t.error(e)}):r.errorMessage="Oops! Title and description are required."},r.$on("spaceMembersChanged",function(e,n){c.updateById({id:a.id},r.space,function(e){r.editableSpace=angular.copy(r.space)},function(e){t.error(e)})}),r.onDelete=function(){o.open({template:"space/delete-space-dialog.html",controller:["$location","$rootScope","$routeParams","$scope","Space",function(e,a,n,r,o){r.onConfirmClick=function(){o.deleteById({id:n.id},function(){a.$apply(function(){e.path("/")}),r.closeThisDialog()},function(e){t.error(e)})}}]})},function(){c.getById({id:a.id},function(e){r.space=e,r.editableSpace=angular.copy(e),i.getById({id:e.created_by},function(e){r.createdBy=e},function(e){t.error(e)})},function(e){t.error(e)})}()}]),angular.module("myApp.services").service("Space",["$cacheFactory",function(e){var t=e("space");this.getAll=function(e,a){Data.Space.getAll().then(function(a){a.forEach(function(e){t.put(e.id,e)}),e(angular.copy(a))},function(t){a?a(t):e(t)})},this.getById=function(e,a,n){e.id||n("A required parameter (id) is missing.");var r=t.get(e.id);r?a(angular.copy(r)):Data.Space.getById(e.id).then(function(e){t.put(e.id,e),a(angular.copy(e))},function(e){n?n(e):a(e)})},this.updateById=function(e,a,n,r){e.id||r("A required parameter (id) is missing."),Data.Space.updateById(e.id,a).then(function(e){t.put(e.id,e),n(angular.copy(e))},function(e){r?r(e):n(e)})},this.create=function(e,a,n){Data.Space.create(e).then(function(e){t.put(e.id,e),a(angular.copy(e))},function(e){n?n(e):a(e)})},this.deleteById=function(e,a,n){e.id||n("A required parameter (id) is missing."),Data.Space.deleteById(e.id).then(function(){t.remove(e.id),a()},function(e){n?n(e):a(e)})}}]),angular.module("myApp.services").service("User",["$cacheFactory",function(e){var t=e("user");this.getAll=function(e,a){Data.User.getAll().then(function(a){a.forEach(function(e){t.put(e.id,e)}),e(angular.copy(a))},function(t){a?a(t):e(t)})},this.getById=function(e,a,n){e.id||n("A required parameter (id) is missing.");var r=t.get(e.id);r?a(angular.copy(r)):Data.User.getById(e.id).then(function(e){t.put(e.id,e),a(angular.copy(e))},function(e){n?n(e):a(e)})},this.updateById=function(e,a,n,r){e.id||r("A required parameter (id) is missing."),Data.User.updateById(e.id,a).then(function(e){t.put(e.id,e),n(angular.copy(e))},function(e){r?r(e):n(e)})},this.create=function(e,a,n){Data.User.create(e).then(function(e){t.put(e.id,e),a(angular.copy(e))},function(e){n?n(e):a(e)})},this.deleteById=function(e,a,n){e.id||n("A required parameter (id) is missing."),Data.User.deleteById(e.id).then(function(){t.remove(e.id),a()},function(e){n?n(e):a(e)})}}]),angular.module("myApp.directives").directive("altHeader",["$location","$log","ngDialog",function(e,t,a){function n(n,r,o){n.openCreateSpaceDialog=function(){a.open({template:"components/alt-header/create-space-dialog.html",controller:["$rootScope","$scope","Space",function(a,n,r){function o(){return n.title&&n.description?!0:!1}n.onCreateClick=function(){return o()?void r.create({title:n.title,description:n.description,welcome:n.welcome?1:0,"private":n["private"]?1:0,featured:n.featured?1:0,created_by:1},function(t){a.$apply(function(){e.path("/spaces/"+t.id)}),n.closeThisDialog()},function(e){t.error(e)}):n.errorMessage="Oops! Title and description are required."}}]})}}return{restrict:"E",replace:!0,scope:{},link:n,templateUrl:"components/alt-header/alt-header.html"}}]),angular.module("myApp.directives").directive("altChart",["ngDialog",function(e){function t(e,t,a){var n=[{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0},{date:"",close:0}],r=new Date;n.forEach(function(e,t){e.date=new Date(r.getTime()-36e5*t)});var o={top:12,right:12,bottom:128,left:24},c=1024-o.left-o.right,i=512-o.top-o.bottom,l=d3.time.scale().range([0,c]),s=d3.scale.linear().range([i,0]),d=d3.svg.axis().scale(l).orient("bottom").ticks(d3.time.hours,6).tickFormat(d3.time.format("%x %I%p")),u=d3.svg.axis().scale(s).orient("left").ticks(10),p=d3.svg.line().x(function(e){return l(e.date)}).y(function(e){return s(e.close)}),f=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return'<div class="tooltip"><strong>'+e.date.getHours()+":"+e.date.getMinutes()+"</strong> <span>"+e.close+" Users</span></div>"}),m=d3.select("#visualisation").append("svg").attr("width",c+o.left+o.right).attr("height",i+o.top+o.bottom).append("g").attr("transform","translate("+o.left+","+o.top+")"),g=m.append("g");m.call(f),n.forEach(function(e,t){e.date=e.date,e.close=+Math.floor(16*Math.random()+1)}),l.domain(d3.extent(n,function(e){return e.date})),s.domain([0,d3.max(n,function(e){return e.close})]),m.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(d).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(e){return"rotate(-60)"}),m.append("g").attr("class","y axis").call(u),g.append("path").attr("class","line").attr("d",p(n)),m.selectAll(".circle").data(n).enter().append("svg:circle").attr("class","circle").attr("cx",function(e,t){return l(e.date)}).attr("cy",function(e,t){return s(e.close)}).attr("r",4).on("mouseover",f.show).on("mouseout",f.hide)}return{restrict:"E",replace:!0,scope:{},link:t,templateUrl:"space/alt-chart/alt-chart.html"}}]),angular.module("myApp.directives").directive("altMemberSelect",["$log","User",function(e,t){function a(a,n,r){a.getUserTileClasses=function(e){var t=[];return a.members&&a.members.indexOf(e.id)>-1&&t.push("member"),t},a.onUserTileClick=function(e){a.members||(a.members=[]);var t=a.members.indexOf(e.id);t>-1?a.members.splice(t,1):a.members.push(e.id),a.$emit("spaceMembersChanged",a.members)},function(){t.getAll(function(e){a.users=e},function(t){e.error(t)})}()}return{restrict:"E",replace:!0,scope:{members:"="},link:a,templateUrl:"space/alt-member-select/alt-member-select.html"}}]);